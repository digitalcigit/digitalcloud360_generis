============================= test session starts ==============================
platform linux -- Python 3.11.14, pytest-9.0.2, pluggy-1.6.0
rootdir: /app
configfile: pytest.ini
plugins: anyio-4.12.0, mock-3.15.1, Faker-39.0.0, asyncio-1.3.0, langsmith-0.5.0
asyncio: mode=Mode.AUTO, debug=False, asyncio_default_fixture_loop_scope=function, asyncio_default_test_loop_scope=function
collected 6 items

tests/test_e2e/test_coaching_flow.py FF                                  [ 33%]
tests/test_e2e/test_coaching_silver_features.py FF.F                     [100%]

=================================== FAILURES ===================================
__________ TestCoachingFlowE2E.test_full_coaching_to_site_generation ___________
tests/test_e2e/test_coaching_flow.py:29: in test_full_coaching_to_site_generation
    assert len(data["clickable_choices"]) > 0
E   assert 0 > 0
E    +  where 0 = len([])
---------------------------- Captured stdout setup -----------------------------
2025-12-20 07:58:24 [info     ] Request started                client_ip=127.0.0.1 method=POST url=http://testserver/api/v1/auth/token
2025-12-20 07:58:24 [info     ] Request completed              duration_seconds=0.6662192344665527 method=POST status_code=200 url=http://testserver/api/v1/auth/token
---------------------------- Captured stderr setup -----------------------------
INFO:httpx:HTTP Request: POST http://testserver/api/v1/auth/token "HTTP/1.1 200 OK"
------------------------------ Captured log setup ------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://testserver/api/v1/auth/token "HTTP/1.1 200 OK"
----------------------------- Captured stdout call -----------------------------
2025-12-20 07:58:25 [info     ] Request started                client_ip=127.0.0.1 method=POST url=http://testserver/api/v1/coaching/start
2025-12-20 07:58:25 [info     ] PromptsLoader initialized with 5 coaching steps
2025-12-20 07:58:25 [info     ] Request completed              duration_seconds=0.05990099906921387 method=POST status_code=200 url=http://testserver/api/v1/coaching/start
----------------------------- Captured stderr call -----------------------------
INFO:httpx:HTTP Request: POST http://testserver/api/v1/coaching/start "HTTP/1.1 200 OK"
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://testserver/api/v1/coaching/start "HTTP/1.1 200 OK"
_____________ TestCoachingFlowE2E.test_coaching_validation_failure _____________
tests/test_e2e/test_coaching_flow.py:90: in test_coaching_validation_failure
    assert data["current_step"] == CoachingStepEnum.VISION.value
E   AssertionError: assert 'mission' == 'vision'
E     
E     - vision
E     ? ^
E     + mission
E     ? ^ +
---------------------------- Captured stdout setup -----------------------------
2025-12-20 07:58:27 [info     ] Request started                client_ip=127.0.0.1 method=POST url=http://testserver/api/v1/auth/token
2025-12-20 07:58:28 [info     ] Request completed              duration_seconds=0.5244796276092529 method=POST status_code=200 url=http://testserver/api/v1/auth/token
---------------------------- Captured stderr setup -----------------------------
INFO:httpx:HTTP Request: POST http://testserver/api/v1/auth/token "HTTP/1.1 200 OK"
------------------------------ Captured log setup ------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://testserver/api/v1/auth/token "HTTP/1.1 200 OK"
----------------------------- Captured stdout call -----------------------------
2025-12-20 07:58:28 [info     ] Request started                client_ip=127.0.0.1 method=POST url=http://testserver/api/v1/coaching/start
2025-12-20 07:58:28 [info     ] PromptsLoader initialized with 5 coaching steps
2025-12-20 07:58:28 [info     ] Request completed              duration_seconds=0.04828453063964844 method=POST status_code=200 url=http://testserver/api/v1/coaching/start
2025-12-20 07:58:28 [info     ] Request started                client_ip=127.0.0.1 method=POST url=http://testserver/api/v1/coaching/step
2025-12-20 07:58:28 [info     ] Création LLM provider          model=deepseek-chat plan=genesis_basic provider=deepseek
2025-12-20 07:58:28 [info     ] DeepseekProvider initialized   base_url=https://api.deepseek.com model=deepseek-chat
2025-12-20 07:58:28 [info     ] PromptsLoader initialized with 5 coaching steps
2025-12-20 07:58:28 [info     ] CoachingLLMService initialized with Deepseek provider
2025-12-20 07:58:28 [info     ] PromptsLoader initialized with 5 coaching steps
2025-12-20 07:58:28 [info     ] Deepseek generate request      model=deepseek-chat prompt_length=622 temperature=0.1
2025-12-20 07:58:29 [error    ] Deepseek API error             response='{"error":{"message":"Authentication Fails, Your api key: ****a3d3 is invalid","type":"authentication_error","param":null,"code":"invalid_request_error"}}' status_code=401
2025-12-20 07:58:29 [error    ] sector_detection_failed        error='Deepseek API error: 401'
2025-12-20 07:58:29 [info     ] requesting_llm_extraction      sector=default step=vision
2025-12-20 07:58:29 [info     ] Deepseek generate_structured request
2025-12-20 07:58:29 [info     ] Deepseek generate request      model=deepseek-chat prompt_length=1314 temperature=0.3
2025-12-20 07:58:29 [error    ] Deepseek API error             response='{"error":{"message":"Authentication Fails, Your api key: ****a3d3 is invalid","type":"authentication_error","param":null,"code":"invalid_request_error"}}' status_code=401
2025-12-20 07:58:29 [error    ] llm_extraction_failed          error='Deepseek API error: 401' step=vision
2025-12-20 07:58:29 [info     ] Request completed              duration_seconds=1.2650072574615479 method=POST status_code=200 url=http://testserver/api/v1/coaching/step
----------------------------- Captured stderr call -----------------------------
INFO:httpx:HTTP Request: POST http://testserver/api/v1/coaching/start "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST https://api.deepseek.com/v1/chat/completions "HTTP/1.1 401 Unauthorized"
INFO:httpx:HTTP Request: POST https://api.deepseek.com/v1/chat/completions "HTTP/1.1 401 Unauthorized"
INFO:httpx:HTTP Request: POST http://testserver/api/v1/coaching/step "HTTP/1.1 200 OK"
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://testserver/api/v1/coaching/start "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1740 HTTP Request: POST https://api.deepseek.com/v1/chat/completions "HTTP/1.1 401 Unauthorized"
INFO     httpx:_client.py:1740 HTTP Request: POST https://api.deepseek.com/v1/chat/completions "HTTP/1.1 401 Unauthorized"
INFO     httpx:_client.py:1740 HTTP Request: POST http://testserver/api/v1/coaching/step "HTTP/1.1 200 OK"
__________ TestSilverCoachingFeaturesE2E.test_coaching_help_socratic ___________
tests/test_e2e/test_coaching_silver_features.py:29: in test_coaching_help_socratic
    assert len(data["socratic_questions"]) >= 2
E   assert 0 >= 2
E    +  where 0 = len([])
---------------------------- Captured stdout setup -----------------------------
2025-12-20 07:58:30 [info     ] Request started                client_ip=127.0.0.1 method=POST url=http://testserver/api/v1/auth/token
2025-12-20 07:58:31 [info     ] Request completed              duration_seconds=0.49035048484802246 method=POST status_code=200 url=http://testserver/api/v1/auth/token
---------------------------- Captured stderr setup -----------------------------
INFO:httpx:HTTP Request: POST http://testserver/api/v1/auth/token "HTTP/1.1 200 OK"
------------------------------ Captured log setup ------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://testserver/api/v1/auth/token "HTTP/1.1 200 OK"
----------------------------- Captured stdout call -----------------------------
2025-12-20 07:58:31 [info     ] Request started                client_ip=127.0.0.1 method=POST url=http://testserver/api/v1/coaching/start
2025-12-20 07:58:31 [info     ] PromptsLoader initialized with 5 coaching steps
2025-12-20 07:58:31 [info     ] Request completed              duration_seconds=0.039595842361450195 method=POST status_code=200 url=http://testserver/api/v1/coaching/start
2025-12-20 07:58:31 [info     ] Request started                client_ip=127.0.0.1 method=POST url=http://testserver/api/v1/coaching/help
2025-12-20 07:58:31 [info     ] Création LLM provider          model=deepseek-chat plan=genesis_basic provider=deepseek
2025-12-20 07:58:31 [info     ] DeepseekProvider initialized   base_url=https://api.deepseek.com model=deepseek-chat
2025-12-20 07:58:31 [info     ] PromptsLoader initialized with 5 coaching steps
2025-12-20 07:58:31 [info     ] CoachingLLMService initialized with Deepseek provider
2025-12-20 07:58:31 [info     ] Deepseek generate_structured request
2025-12-20 07:58:31 [info     ] Deepseek generate request      model=deepseek-chat prompt_length=601 temperature=0.3
2025-12-20 07:58:31 [error    ] Deepseek API error             response='{"error":{"message":"Authentication Fails, Your api key: ****a3d3 is invalid","type":"authentication_error","param":null,"code":"invalid_request_error"}}' status_code=401
2025-12-20 07:58:31 [error    ] socratic_help_failed           error='Deepseek API error: 401'
2025-12-20 07:58:31 [info     ] Request completed              duration_seconds=0.6150674819946289 method=POST status_code=200 url=http://testserver/api/v1/coaching/help
----------------------------- Captured stderr call -----------------------------
INFO:httpx:HTTP Request: POST http://testserver/api/v1/coaching/start "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST https://api.deepseek.com/v1/chat/completions "HTTP/1.1 401 Unauthorized"
INFO:httpx:HTTP Request: POST http://testserver/api/v1/coaching/help "HTTP/1.1 200 OK"
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://testserver/api/v1/coaching/start "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1740 HTTP Request: POST https://api.deepseek.com/v1/chat/completions "HTTP/1.1 401 Unauthorized"
INFO     httpx:_client.py:1740 HTTP Request: POST http://testserver/api/v1/coaching/help "HTTP/1.1 200 OK"
__________ TestSilverCoachingFeaturesE2E.test_reformulate_on_the_fly ___________
tests/test_e2e/test_coaching_silver_features.py:48: in test_reformulate_on_the_fly
    assert data["reformulated_text"] != long_text
E   AssertionError: assert 'Je veux faire un truc de livraison de nourriture bio mais je sais pas trop comment dire ça proprement pour que ça fasse pro.' != 'Je veux faire un truc de livraison de nourriture bio mais je sais pas trop comment dire ça proprement pour que ça fasse pro.'
---------------------------- Captured stdout setup -----------------------------
2025-12-20 07:58:32 [info     ] Request started                client_ip=127.0.0.1 method=POST url=http://testserver/api/v1/auth/token
2025-12-20 07:58:33 [info     ] Request completed              duration_seconds=0.48883724212646484 method=POST status_code=200 url=http://testserver/api/v1/auth/token
---------------------------- Captured stderr setup -----------------------------
INFO:httpx:HTTP Request: POST http://testserver/api/v1/auth/token "HTTP/1.1 200 OK"
------------------------------ Captured log setup ------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://testserver/api/v1/auth/token "HTTP/1.1 200 OK"
----------------------------- Captured stdout call -----------------------------
2025-12-20 07:58:33 [info     ] Request started                client_ip=127.0.0.1 method=POST url=http://testserver/api/v1/coaching/reformulate
2025-12-20 07:58:33 [info     ] Création LLM provider          model=deepseek-chat plan=genesis_basic provider=deepseek
2025-12-20 07:58:33 [info     ] DeepseekProvider initialized   base_url=https://api.deepseek.com model=deepseek-chat
2025-12-20 07:58:33 [info     ] PromptsLoader initialized with 5 coaching steps
2025-12-20 07:58:33 [info     ] CoachingLLMService initialized with Deepseek provider
2025-12-20 07:58:33 [info     ] Deepseek generate_structured request
2025-12-20 07:58:33 [info     ] Deepseek generate request      model=deepseek-chat prompt_length=666 temperature=0.3
2025-12-20 07:58:33 [error    ] Deepseek API error             response='{"error":{"message":"Authentication Fails, Your api key: ****a3d3 is invalid","type":"authentication_error","param":null,"code":"invalid_request_error"}}' status_code=401
2025-12-20 07:58:33 [error    ] reformulation_failed           error='Deepseek API error: 401'
2025-12-20 07:58:33 [info     ] Request completed              duration_seconds=0.583960771560669 method=POST status_code=200 url=http://testserver/api/v1/coaching/reformulate
----------------------------- Captured stderr call -----------------------------
INFO:httpx:HTTP Request: POST https://api.deepseek.com/v1/chat/completions "HTTP/1.1 401 Unauthorized"
INFO:httpx:HTTP Request: POST http://testserver/api/v1/coaching/reformulate "HTTP/1.1 200 OK"
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST https://api.deepseek.com/v1/chat/completions "HTTP/1.1 401 Unauthorized"
INFO     httpx:_client.py:1740 HTTP Request: POST http://testserver/api/v1/coaching/reformulate "HTTP/1.1 200 OK"
____________ TestSilverCoachingFeaturesE2E.test_generate_proposals _____________
tests/test_e2e/test_coaching_silver_features.py:83: in test_generate_proposals
    assert len(data["proposals"]) == 3
E   assert 0 == 3
E    +  where 0 = len([])
---------------------------- Captured stdout setup -----------------------------
2025-12-20 07:58:36 [info     ] Request started                client_ip=127.0.0.1 method=POST url=http://testserver/api/v1/auth/token
2025-12-20 07:58:37 [info     ] Request completed              duration_seconds=0.45974063873291016 method=POST status_code=200 url=http://testserver/api/v1/auth/token
---------------------------- Captured stderr setup -----------------------------
INFO:httpx:HTTP Request: POST http://testserver/api/v1/auth/token "HTTP/1.1 200 OK"
------------------------------ Captured log setup ------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://testserver/api/v1/auth/token "HTTP/1.1 200 OK"
----------------------------- Captured stdout call -----------------------------
2025-12-20 07:58:37 [info     ] Request started                client_ip=127.0.0.1 method=POST url=http://testserver/api/v1/coaching/start
2025-12-20 07:58:37 [info     ] PromptsLoader initialized with 5 coaching steps
2025-12-20 07:58:37 [info     ] Request completed              duration_seconds=0.04399728775024414 method=POST status_code=200 url=http://testserver/api/v1/coaching/start
2025-12-20 07:58:37 [info     ] Request started                client_ip=127.0.0.1 method=POST url=http://testserver/api/v1/coaching/generate-proposals
2025-12-20 07:58:37 [info     ] Création LLM provider          model=deepseek-chat plan=genesis_basic provider=deepseek
2025-12-20 07:58:37 [info     ] DeepseekProvider initialized   base_url=https://api.deepseek.com model=deepseek-chat
2025-12-20 07:58:37 [info     ] PromptsLoader initialized with 5 coaching steps
2025-12-20 07:58:37 [info     ] CoachingLLMService initialized with Deepseek provider
2025-12-20 07:58:37 [info     ] Deepseek generate_structured request
2025-12-20 07:58:37 [info     ] Deepseek generate request      model=deepseek-chat prompt_length=622 temperature=0.3
2025-12-20 07:58:37 [error    ] Deepseek API error             response='{"error":{"message":"Authentication Fails, Your api key: ****a3d3 is invalid","type":"authentication_error","param":null,"code":"invalid_request_error"}}' status_code=401
2025-12-20 07:58:37 [error    ] proposals_generation_failed    error='Deepseek API error: 401'
2025-12-20 07:58:37 [info     ] Request completed              duration_seconds=0.6032803058624268 method=POST status_code=200 url=http://testserver/api/v1/coaching/generate-proposals
----------------------------- Captured stderr call -----------------------------
INFO:httpx:HTTP Request: POST http://testserver/api/v1/coaching/start "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST https://api.deepseek.com/v1/chat/completions "HTTP/1.1 401 Unauthorized"
INFO:httpx:HTTP Request: POST http://testserver/api/v1/coaching/generate-proposals "HTTP/1.1 200 OK"
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://testserver/api/v1/coaching/start "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1740 HTTP Request: POST https://api.deepseek.com/v1/chat/completions "HTTP/1.1 401 Unauthorized"
INFO     httpx:_client.py:1740 HTTP Request: POST http://testserver/api/v1/coaching/generate-proposals "HTTP/1.1 200 OK"
=========================== short test summary info ============================
FAILED tests/test_e2e/test_coaching_flow.py::TestCoachingFlowE2E::test_full_coaching_to_site_generation
FAILED tests/test_e2e/test_coaching_flow.py::TestCoachingFlowE2E::test_coaching_validation_failure
FAILED tests/test_e2e/test_coaching_silver_features.py::TestSilverCoachingFeaturesE2E::test_coaching_help_socratic
FAILED tests/test_e2e/test_coaching_silver_features.py::TestSilverCoachingFeaturesE2E::test_reformulate_on_the_fly
FAILED tests/test_e2e/test_coaching_silver_features.py::TestSilverCoachingFeaturesE2E::test_generate_proposals
================== 5 failed, 1 passed, 21 warnings in 15.54s ===================
