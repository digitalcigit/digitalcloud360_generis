============================= test session starts ==============================
platform linux -- Python 3.11.14, pytest-9.0.2, pluggy-1.6.0
rootdir: /app
configfile: pytest.ini
plugins: anyio-4.12.0, mock-3.15.1, Faker-39.0.0, asyncio-1.3.0, langsmith-0.5.0
asyncio: mode=Mode.AUTO, debug=False, asyncio_default_fixture_loop_scope=function, asyncio_default_test_loop_scope=function
collected 6 items

tests/test_e2e/test_coaching_flow.py F.                                  [ 33%]
tests/test_e2e/test_coaching_silver_features.py ....                     [100%]

=================================== FAILURES ===================================
__________ TestCoachingFlowE2E.test_full_coaching_to_site_generation ___________
tests/test_e2e/test_coaching_flow.py:54: in test_full_coaching_to_site_generation
    assert step_data["is_step_complete"] is True
E   assert False is True
---------------------------- Captured stdout setup -----------------------------
2025-12-20 08:57:02 [info     ] Request started                client_ip=127.0.0.1 method=POST url=http://testserver/api/v1/auth/token
2025-12-20 08:57:03 [info     ] Request completed              duration_seconds=0.5012331008911133 method=POST status_code=200 url=http://testserver/api/v1/auth/token
---------------------------- Captured stderr setup -----------------------------
INFO:httpx:HTTP Request: POST http://testserver/api/v1/auth/token "HTTP/1.1 200 OK"
------------------------------ Captured log setup ------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://testserver/api/v1/auth/token "HTTP/1.1 200 OK"
----------------------------- Captured stdout call -----------------------------
2025-12-20 08:57:03 [info     ] Request started                client_ip=127.0.0.1 method=POST url=http://testserver/api/v1/coaching/start
2025-12-20 08:57:03 [info     ] PromptsLoader initialized with 5 coaching steps
2025-12-20 08:57:03 [info     ] Request completed              duration_seconds=0.07347631454467773 method=POST status_code=200 url=http://testserver/api/v1/coaching/start
2025-12-20 08:57:03 [info     ] Request started                client_ip=127.0.0.1 method=POST url=http://testserver/api/v1/coaching/step
2025-12-20 08:57:03 [info     ] Cr√©ation LLM provider          model=deepseek-chat plan=genesis_basic provider=deepseek
2025-12-20 08:57:03 [info     ] DeepseekProvider initialized   base_url=https://api.deepseek.com model=deepseek-chat
2025-12-20 08:57:03 [info     ] PromptsLoader initialized with 5 coaching steps
2025-12-20 08:57:03 [info     ] CoachingLLMService initialized with Deepseek provider
2025-12-20 08:57:03 [info     ] PromptsLoader initialized with 5 coaching steps
2025-12-20 08:57:03 [info     ] Deepseek generate request      model=deepseek-chat prompt_length=685 temperature=0.1
2025-12-20 08:57:05 [info     ] Deepseek generate success      response_length=5 tokens_used=224
2025-12-20 08:57:05 [info     ] sector_detected                sector=salon
2025-12-20 08:57:05 [info     ] requesting_llm_extraction      sector=salon step=vision
2025-12-20 08:57:05 [info     ] Deepseek generate_structured request
2025-12-20 08:57:05 [info     ] Deepseek generate request      model=deepseek-chat prompt_length=1375 temperature=0.3
2025-12-20 08:57:13 [info     ] Deepseek generate success      response_length=767 tokens_used=1085
2025-12-20 08:57:13 [info     ] Deepseek structured response parsed successfully
2025-12-20 08:57:13 [info     ] llm_extraction_completed       clarification=True confidence=0.4 is_valid=False step=vision
2025-12-20 08:57:13 [info     ] Request completed              duration_seconds=9.797740697860718 method=POST status_code=200 url=http://testserver/api/v1/coaching/step
----------------------------- Captured stderr call -----------------------------
INFO:httpx:HTTP Request: POST http://testserver/api/v1/coaching/start "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST https://api.deepseek.com/v1/chat/completions "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST https://api.deepseek.com/v1/chat/completions "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://testserver/api/v1/coaching/step "HTTP/1.1 200 OK"
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://testserver/api/v1/coaching/start "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1740 HTTP Request: POST https://api.deepseek.com/v1/chat/completions "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1740 HTTP Request: POST https://api.deepseek.com/v1/chat/completions "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1740 HTTP Request: POST http://testserver/api/v1/coaching/step "HTTP/1.1 200 OK"
=========================== short test summary info ============================
FAILED tests/test_e2e/test_coaching_flow.py::TestCoachingFlowE2E::test_full_coaching_to_site_generation
============= 1 failed, 5 passed, 21 warnings in 86.07s (0:01:26) ==============
